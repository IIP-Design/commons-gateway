Resources:
  SQSSend2FA:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: content-gateway-${opt:stage}-send-2fa

  SQSAprimoUploadDLQ:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: content-gateway-${opt:stage}-aprimo-upload-dlq

  SQSAprimoUpload:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: content-gateway-${opt:stage}-aprimo-upload
      RedrivePolicy:
         deadLetterTargetArn : arn:aws:sqs:${aws:region}:${aws:accountId}:content-gateway-${opt:stage}-aprimo-upload-dlq
         maxReceiveCount: 5

  SQSAprimoRecordDLQ:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: content-gateway-${opt:stage}-aprimo-record-dlq

  SQSAprimoRecord:
    Type: AWS::SQS::Queue
    Properties:
      QueueName: content-gateway-${opt:stage}-aprimo-record
      RedrivePolicy:
         deadLetterTargetArn : arn:aws:sqs:${aws:region}:${aws:accountId}:content-gateway-${opt:stage}-aprimo-record-dlq
         maxReceiveCount: 5

  SQSAprimoUploadPolicy:
    Type: AWS::SQS::QueuePolicy
    Properties:
      Queues:
        - !Ref SQSAprimoUpload
      PolicyDocument:
        Id: s3-access-entry
        Version: '2012-10-17'
        Statement:
          - Sid: Allow-S3-SendMessage
            Effect: Allow
            Principal:
              Service: s3.amazonaws.com
            Action:
              - SQS:SendMessage
            Resource: arn:aws:sqs:${aws:region}:${aws:accountId}:content-gateway-${opt:stage}-aprimo-upload
            Condition:
              StringEquals:
                aws:SourceAccount: ${aws:accountId}
              ArnLike:
                aws:SourceArn: arn:aws:s3:*:*:*