service: commons-gateway

frameworkVersion: "3"

provider:
  name: aws

package:
  patterns:
    - "!./**"
    - ./bin/**

functions:
  admin-create:
    name: gateway-admin-create
    handler: bin/admin-create
    description: Add an new email to the list of admin users.
    runtime: go1.x
    events:
      - http:
          path: /admin/create
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  admins-get:
    name: gateway-admins-get
    handler: bin/admins-get
    description: Retrieve the list of admin users.
    runtime: go1.x
    events:
      - http:
          path: /admins
          method: get
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  guest-auth:
    name: gateway-guest-auth
    handler: bin/guest-auth
    description: Authenticate a guest user.
    runtime: go1.x
    events:
      - http:
          path: /guest/auth
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  guests-get:
    name: gateway-guests-get
    handler: bin/guests-get
    description: Retrieve a list of guest users.
    runtime: go1.x
    events:
      - http:
          path: /guests
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  team-create:
    name: gateway-team-create
    handler: bin/team-create
    description: Create a new team.
    runtime: go1.x
    events:
      - http:
          path: /team/create
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  teams-get:
    name: gateway-teams-get
    handler: bin/teams-get
    description: Retrieve the list of teams.
    runtime: go1.x
    events:
      - http:
          path: /teams
          method: get
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  creds-salt:
    name: gateway-creds-retrieve
    handler: bin/creds-salt
    description: Retrieve a users hashing salt.
    runtime: go1.x
    events:
      - http:
          path: /creds/salt
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  creds-provision:
    name: gateway-creds-provision
    handler: bin/creds-provision
    description: Records a guest user invitation and generates credentials for this user.
    runtime: go1.x
    events:
      - http:
          path: /creds/provision
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  email-2fa:
    name: gateway-email-2fa
    handler: funcs/email-2fa/dist/index.handler
    description: Email an invitee their temporary verification code.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-2fa
  email-creds:
    name: gateway-email-creds
    handler: funcs/email-creds/dist/index.handler
    description: Email an invitee their temporary credentials.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-creds
  email-support-staff:
    name: gateway-email-support-staff
    handler: funcs/email-support-staff/index.handler
    description: Email a Content Commons user an update on requested support staff.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-support-staff
