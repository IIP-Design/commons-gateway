service: commons-gateway

frameworkVersion: "3"

provider:
  name: aws
  runtime: go1.x
  httpApi:
    cors: true

package:
  patterns:
    - "!./**"
    - ./bin/**

functions:
  admin-create:
    name: gateway-create-admin
    handler: bin/admin-create
    description: Add an new email to the list of admin users.
    events:
      - http:
          path: /admin/create
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  admins-get:
    name: gateway-get-admins
    handler: bin/admins-get
    description: Retrieve the list of admin users.
    events:
      - http:
          path: /admins/get
          method: get
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  guest-auth:
    name: gateway-guest-auth
    handler: bin/guest-auth
    description: Authenticate a guest user.
    events:
      - httpApi:
          path: /guest-auth
          method: post
  guests-get:
    name: gateway-guests-get
    handler: bin/guests-get
    description: Retrieve a list of guest users.
    events:
      - http:
          path: /guests/get
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  teams-get:
    name: gateway-get-teams
    handler: bin/teams-get
    description: Retrieve the list of teams.
    events:
      - http:
          path: /teams/get
          method: get
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  creds-salt:
    name: gateway-retrieve-creds
    handler: bin/creds-salt
    description: Retrieve a users password hash and salt.
    events:
      - http:
          path: /creds/salt
          method: post
          cors:
            origin: ${file(./config/${opt:stage, 'dev'}.json):cors.allowedOrigins}
  creds-provision:
    name: gateway-provision-creds
    handler: bin/creds-provision
    description: Records a guest user invitation and generates credentials for this user.
    events:
      - httpApi:
          path: /creds/provision
          method: post
  email-2fa:
    name: gateway-email-2fa
    handler: funcs/email-2fa/dist/index.handler
    description: Email an invitee their temporary verification code.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-2fa
  email-creds:
    name: gateway-email-creds
    handler: funcs/email-creds/dist/index.handler
    description: Email an invitee their temporary credentials.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-creds
  email-support-staff:
    name: gateway-email-support-staff
    handler: funcs/email-support-staff/index.handler
    description: Email a Content Commons user an update on requested support staff.
    runtime: nodejs18.x
    events:
      - sqs: arn:aws:sqs:us-east-1:601587284985:contentCommons-email-support-staff
